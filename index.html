<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ID IMPORT - PRODUCTOS ATITUDE</title>
    <style>
        body { font-family: Arial, sans-serif; }
        h1 { text-align: center; margin-top: 1rem; }
        #busqueda { width: 280px; padding: 8px; border: 1px solid #aaa; margin-bottom: 10px; }
        #abrirSeleccionados { margin: 10px 0 18px 0; padding: 9px 18px; border: none; background: #186fb7; color: #fff; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .catalogo { display: flex; flex-wrap: wrap; gap: 18px; justify-content: center; }
        .item { border: 1px solid #ccc; width: 220px; padding: 12px; margin: 5px 0; text-align: center; background: #f9f9ff; border-radius: 8px; }
        .item img { max-width: 98%; max-height: 120px; margin: 5px 0 10px 0; }
        .cantidad { width: 55px; margin-bottom: 8px; }
        .paginado { text-align: center; margin: 16px 0 12px 0; }
        .paginado button { margin: 2px; padding: 6px 10px; border-radius: 3px; border: 1px solid #186fb7; background: #fff; color: #186fb7; font-weight: bold; cursor: pointer; }
        .paginado .active { background: #186fb7; color: #fff; }
        #productosPorPagina { width: 52px; margin-left: 10px; }
    </style>
</head>
<body>
    <h1>ID IMPORT - PRODUCTOS ATITUDE</h1>
    <div style="text-align:center;">
        <input type="text" id="busqueda" placeholder="Buscar por modelo...">
        <button id="abrirSeleccionados">Abrir Página con productos seleccionados</button>
    </div>
    <div style="text-align:center; margin-bottom:10px;">
        Mostrar
        <select id="productosPorPagina">
            <option>10</option>
            <option selected>30</option>
            <option>50</option>
            <option value="100">100</option>
        </select>
        productos por página
    </div>
    <div id="catalogo" class="catalogo"></div>
    <div class="paginado" id="paginado"></div>

    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <script>
        let productos = [];
        let paginaActual = 1;
        let productosPorPagina = 30;
        let busquedaActual = "";
        let seleccionados = {};
        let cantidades = {};

        function filtrarProductos() {
            if(!busquedaActual) return productos;
            return productos.filter(p =>
                p.MODELO && p.MODELO.toLowerCase().includes(busquedaActual.toLowerCase())
            );
        }

        function mostrarProductos() {
            let datos = filtrarProductos();
            let inicio = (paginaActual - 1) * productosPorPagina;
            let fin = inicio + productosPorPagina;
            let paginados = datos.slice(inicio, fin);

            let catalogo = document.getElementById("catalogo");
            catalogo.innerHTML = "";
            paginados.forEach((p, idx) => {
                let checked = seleccionados[p.ID] ? "checked" : "";
                let cantidad = cantidades[p.ID] || "";
                let el = document.createElement("div");
                el.className = "item";
                el.innerHTML = `
                    <div><b>Marca:</b> ${p.MARCA}</div>
                    <div><b>Modelo:</b> ${p.MODELO}</div>
                    <img src="${p.ENLACE}" alt="Imagen">
                    <div>
                        <label>Cantidad: 
                            <input class="cantidad" min="1" type="number" value="${cantidad}" 
                            onchange="this.value>=1?window.cantidades['${p.ID}']=this.value:'';">
                        </label>
                    </div>
                    <label>
                        <input type="checkbox" ${checked} onchange="window.seleccionados['${p.ID}']=this.checked;">
                        Seleccionar producto
                    </label>
                `;
                catalogo.appendChild(el);
            });
            mostrarPaginado(datos.length);
        }

        function mostrarPaginado(total) {
            let totalPag = Math.ceil(total / productosPorPagina);
            let paginado = document.getElementById("paginado");
            paginado.innerHTML = '';
            if (totalPag < 2) return;
            // Botones paginado
            paginado.innerHTML += `<button onclick="paginar(1)">INICIO</button>`;
            paginado.innerHTML += `<button onclick="paginar(Math.max(1, window.paginaActual-1))">ANTERIOR</button>`;
            for(let i=1;i<=totalPag;i++) {
                paginado.innerHTML += 
                    `<button onclick="paginar(${i})" class="${i===paginaActual?'active':''}">${i}</button>`;
            }
            paginado.innerHTML += `<button onclick="paginar(Math.min(${totalPag}, window.paginaActual+1))">SIGUIENTE</button>`;
            paginado.innerHTML += `<button onclick="paginar(${totalPag})">FINAL</button>`;
        }

        function paginar(num) {
            window.paginaActual=num;
            mostrarProductos();
        }

        // Buscador por modelo
        document.getElementById('busqueda').addEventListener('input', function(e){
            window.busquedaActual = this.value;
            window.paginaActual = 1;
            mostrarProductos();
        });

        document.getElementById('productosPorPagina').addEventListener('change', function(){
            productosPorPagina = +this.value;
            window.paginaActual = 1;
            mostrarProductos();
        });

        document.getElementById('abrirSeleccionados').addEventListener('click', function(){
            // Guarda estado y redirige
            localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
            localStorage.setItem('cantidadesSeleccionadas', JSON.stringify(cantidades));
            location.href = "seleccionados.html";
        });

        // Exponer seleccionados/cantidades global
        window.seleccionados = seleccionados;
        window.cantidades = cantidades;
        window.paginaActual = paginaActual;

        // Cargar productos de CSV
        Papa.parse("atitude01.csv", {
            download: true,
            header: true,
            complete: function(res) {
                productos = res.data;
                mostrarProductos();
            }
        });
    </script>
</body>
</html>

