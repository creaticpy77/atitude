<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ID IMPORT - PRODUCTOS ATITUDE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 10px; }
        h1 { text-align: center; margin-top: 1rem; font-size: 1.6rem; }
        #busqueda { width: 280px; max-width: 90vw; padding: 8px; border: 1px solid #aaa; margin-bottom: 10px; }
        #buscarBtn, #abrirSeleccionados {
            padding: 9px 16px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            background: #186fb7;
            color: white;
            font-weight: bold;
            font-size: 1rem;
            margin: 3px 4px;
        }
        .catalogo {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            justify-content: center;
            transition: all 0.3s;
        }
        .item {
            border: 1px solid #ccc;
            width: 220px;
            padding: 12px;
            background: #f9f9ff;
            border-radius: 8px;
            text-align: center;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        .item img {
            max-width: 98%;
            max-height: 120px;
            margin: 5px 0 10px 0;
            cursor: pointer;
            border-radius: 6px;
        }
        .cantidad { width: 55px; margin-bottom: 8px; }
        .paginado { text-align: center; margin: 16px 0 12px 0; }
        .paginado button {
            margin: 2px; padding: 6px 10px;
            border-radius: 3px; border: 1px solid #186fb7;
            background: #fff; color: #186fb7;
            font-weight: bold; cursor: pointer;
        }
        .paginado .active { background: #186fb7; color: #fff; }
        #productosPorPagina { width: 52px; margin-left: 10px; }
        #viewImgPopup {
            display:none; position:fixed; top:0; left:0; right:0; bottom:0;
            background:rgba(0,0,0,.7);
            justify-content: center; align-items: center; z-index: 9999;
        }
        #imgZoom {
            max-width: 90vw; max-height: 90vh;
            border: 8px solid #fff; border-radius: 8px;
        }
        #cerrarPopup {
            color:white;position:absolute;top:22px;right:32px;
            font-size:2rem;cursor:pointer;z-index:10001;font-weight:bold;
            background:none;outline:none;border:none;
        }
        @media screen and (max-width: 600px) {
            .item {
                width: 90vw;
                padding: 10px;
            }
            #busqueda, #abrirSeleccionados, #buscarBtn {
                width: 90vw;
                margin-bottom: 10px;
                font-size: 1.1rem;
            }
            .paginado button { padding: 8px 10px; font-size: 0.9rem; }
        }
        /* Vista lista (filas) */
        .catalogo.lista { flex-direction: column; align-items:center; }
        .item.lista {
            width: 98vw !important;
            max-width:600px; display: flex;
            align-items: center; text-align:left; gap:16px;
        }
        .item.lista img { max-width: 100px; max-height:100px; margin: 0; }
    </style>
</head>
<body>
<h1>ID IMPORT - PRODUCTOS ATITUDE</h1>
<div style="text-align:center; margin-bottom: 8px;">
    <label>
        <input type="checkbox" id="vistaLista"> Visualizar como lista (filas)
    </label>
</div>
<div style="text-align:center;">
    <input type="text" id="busqueda" placeholder="Buscar por modelo...">
    <button id="buscarBtn" title="Buscar por modelo">üîç</button>
    <button id="abrirSeleccionados">Abrir P√°gina con productos seleccionados</button>
</div>
<div style="text-align:center; margin-bottom:10px;">
    Mostrar
    <select id="productosPorPagina">
        <option>10</option>
        <option selected>30</option>
        <option>50</option>
        <option value="100">100</option>
    </select>
    productos por p√°gina
</div>
<div id="catalogo" class="catalogo"></div>
<div class="paginado" id="paginado"></div>

<div id="viewImgPopup" onclick="this.style.display='none'">
    <span id="cerrarPopup">&times;</span>
    <img id="imgZoom" src="">
</div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
<script>
    // --- CONFIGURACI√ìN ---
    const CSV_PATH = "atitude01.csv";
    // const CSV_PATH = "https://docs.google.com/spreadsheets/d/1Ab_ZH3FGPyEw-_aAKuCXgGw_2bDYJXQKQicqKryNVzg/export?format=csv";

    let productos = [];
    let paginaActual = 1;
    let productosPorPagina = 30;
    let busquedaActual = "";
    let seleccionados = JSON.parse(localStorage.getItem('productosSeleccionados') || '{}');
    let cantidades = JSON.parse(localStorage.getItem('cantidadesSeleccionadas') || '{}');

    function filtrarProductos() {
        if(!busquedaActual) return productos;
        return productos.filter(p =>
            p.MODELO && p.MODELO.toLowerCase().includes(busquedaActual.toLowerCase())
        );
    }

    function mostrarProductos() {
        let datos = filtrarProductos();
        let inicio = (paginaActual - 1) * productosPorPagina;
        let fin = inicio + productosPorPagina;
        let paginados = datos.slice(inicio, fin);

        let catalogo = document.getElementById("catalogo");
        catalogo.innerHTML = "";
        paginados.forEach((p) => {
            let idProducto = p.ID || p.MODELO; // Fallback por si no hay ID
            let checked = seleccionados[idProducto] ? "checked" : "";
            let cantidad = cantidades[idProducto] || "";
            let el = document.createElement("div");
            el.className = "item" + (document.getElementById("vistaLista").checked ? " lista" : "");
            el.innerHTML = `
                <img src="${p.ENLACE}" alt="Imagen" onclick="mostrarImagen('${p.ENLACE}')">
                <div>
                  <div><b>Marca:</b> ${p.MARCA}</div>
                  <div><b>Modelo:</b> ${p.MODELO}</div>
                  <div>
                      <label>Cantidad: 
                          <input class="cantidad" min="1" type="number" value="${cantidad}" 
                          onchange="guardarCantidad('${idProducto}', this.value)">
                      </label>
                  </div>
                  <label>
                      <input type="checkbox" ${checked} onchange="guardarSeleccion('${idProducto}', this.checked)">
                      Seleccionar producto
                  </label>
                </div>
            `;
            catalogo.appendChild(el);
        });
        mostrarPaginado(datos.length);
    }

    function mostrarPaginado(total) {
        let totalPag = Math.ceil(total / productosPorPagina);
        let paginado = document.getElementById("paginado");
        paginado.innerHTML = '';
        if(totalPag < 2) return;
        paginado.innerHTML += `<button onclick="paginar(1)">INICIO</button>`;
        paginado.innerHTML += `<button onclick="paginar(Math.max(1, paginaActual-1))">ANTERIOR</button>`;
        for(let i=1;i<=totalPag;i++) {
            paginado.innerHTML += 
                `<button onclick="paginar(${i})" class="${i===paginaActual?'active':''}">${i}</button>`;
        }
        paginado.innerHTML += `<button onclick="paginar(Math.min(${totalPag}, paginaActual+1))">SIGUIENTE</button>`;
        paginado.innerHTML += `<button onclick="paginar(${totalPag})">FINAL</button>`;
    }

    function paginar(num) {
        paginaActual = num;
        mostrarProductos();
    }

    document.getElementById('buscarBtn').addEventListener('click', function(){
        busquedaActual = document.getElementById("busqueda").value;
        paginaActual = 1;
        mostrarProductos();
    });
    document.getElementById('busqueda').addEventListener('keydown', function(e){
        if(e.key === "Enter") document.getElementById('buscarBtn').click();
    });

    document.getElementById('productosPorPagina').addEventListener('change', function(){
        productosPorPagina = +this.value;
        paginaActual = 1;
        mostrarProductos();
    });

    document.getElementById('abrirSeleccionados').addEventListener('click', function(){
        let tieneSeleccionados = Object.keys(seleccionados).some(key => seleccionados[key] === true);
        if(!tieneSeleccionados) {
            alert('Por favor, selecciona al menos un producto antes de continuar.');
            return;
        }
        localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
        localStorage.setItem('cantidadesSeleccionadas', JSON.stringify(cantidades));
        location.href = "seleccionados.html";
    });

    document.getElementById('vistaLista').addEventListener('change', function() {
        let catalogo = document.getElementById("catalogo");
        if(this.checked){
            catalogo.classList.add("lista");
        } else {
            catalogo.classList.remove("lista");
        }
        mostrarProductos();
    });

    function guardarSeleccion(id, state){
        seleccionados[id] = state;
        localStorage.setItem('productosSeleccionados', JSON.stringify(seleccionados));
        console.log('Seleccionados:', seleccionados); // Debug
    }
    
    function guardarCantidad(id, value){
        if(value >= 1) cantidades[id] = value;
        else delete cantidades[id];
        localStorage.setItem('cantidadesSeleccionadas', JSON.stringify(cantidades));
    }

    window.mostrarImagen = function(src){
        document.getElementById('imgZoom').src = src;
        document.getElementById('viewImgPopup').style.display = "flex";
    };
    document.getElementById('cerrarPopup').onclick = function(e){
        e.stopPropagation();
        document.getElementById('viewImgPopup').style.display = "none";
    };
    window.addEventListener('keydown', function(e){
        if(e.key === "Escape"){
            document.getElementById('viewImgPopup').style.display='none';
        }
    });

    Papa.parse(CSV_PATH, {
        download: true,
        header: true,
        complete: function(res) {
            productos = res.data.filter(p => p.ID || p.MODELO); // Filtra productos vac√≠os
            mostrarProductos();
        }
    });
</script>
</body>
</html>





